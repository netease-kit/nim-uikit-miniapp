<!-- è½¬å‘å¼¹çª—é®ç½© -->
<view class="forward-modal-mask" wx:if="{{visible}}" bindtap="handleMaskClick">
  <!-- è½¬å‘å¼¹çª—å†…å®¹ -->
  <view class="forward-modal" catchtap="stopPropagation">
    <!-- å¼¹çª—å¤´éƒ¨ -->
    <view class="modal-header">
      <view class="header-title" wx:if="{{stage === 'select'}}">é€‰æ‹©è½¬å‘å¯¹è±¡</view>
      <view class="header-title" wx:elif="{{stage === 'comment'}}">å‘é€ç»™</view>
      <view class="header-close" bindtap="handleClose">
        <icon type="close" size="20" color="#666" />
      </view>
    </view>
    
    
    
    <!-- Tab åˆ‡æ¢ -->
    <view class="tab-section" wx:if="{{stage === 'select'}}">
      <view class="tab {{currentTab === 'friend' ? 'active' : ''}}" data-tab="friend" bindtap="handleTabChange">å‘é€ç»™å¥½å‹</view>
      <view class="tab {{currentTab === 'team' ? 'active' : ''}}" data-tab="team" bindtap="handleTabChange">å‘é€ç»™ç¾¤èŠ</view>
    </view>

    
    
    <!-- è”ç³»äººåˆ—è¡¨ -->
    <view class="contacts-section" wx:if="{{stage === 'select'}}">
      <scroll-view class="contacts-list" scroll-y="{{true}}">
        <!-- ç¾¤èŠåˆ—è¡¨ -->
        <view class="contact-group" wx:if="{{currentTab === 'team' && filteredTeams.length > 0}}">
          <view class="group-title">ç¾¤èŠ</view>
          <view 
            class="contact-item"
            wx:for="{{filteredTeams}}"
            wx:key="teamId"
            wx:for-item="team"
            bindtap="handleSelectContact"
            data-contact="{{team}}"
          >
            <message-avatar 
              account="{{team.teamId}}"
              avatar="{{team.avatar}}"
              size="40"
            />
            <view class="contact-info">
              <text class="contact-name">{{team.name}}</text>
              <text class="contact-desc">{{team.memberCount}}äºº</text>
            </view>
            <view class="contact-check" wx:if="{{team.selected}}">
              <icon type="check" size="16" color="#337eff" />
            </view>
          </view>
        </view>
        
        <!-- å¥½å‹åˆ—è¡¨ -->
        <view class="contact-group" wx:if="{{currentTab === 'friend' && filteredFriends.length > 0}}">
          <view class="group-title">å¥½å‹</view>
          <view 
            class="contact-item"
            wx:for="{{filteredFriends}}"
            wx:key="id"
            wx:for-item="friend"
            bindtap="handleSelectContact"
            data-contact="{{friend}}"
          >
            <message-avatar 
              account="{{friend.id}}"
              avatar="{{friend.avatar}}"
              size="40"
            />
            <view class="contact-info">
              <text class="contact-name">{{friend.name}}</text>
              <text class="contact-desc">{{friend.signature || ''}}</text>
            </view>
            <view class="contact-check" wx:if="{{friend.selected}}">
              <icon type="check" size="16" color="#337eff" />
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{(currentTab === 'team' && filteredTeams.length === 0) || (currentTab === 'friend' && filteredFriends.length === 0)}}">
          <view class="empty-icon">ğŸ”</view>
          <view class="empty-text">{{searchText ? 'æœªæ‰¾åˆ°ç›¸å…³è”ç³»äºº' : 'æš‚æ— è”ç³»äºº'}}</view>
        </view>
      </scroll-view>
    </view>
    
    <!-- ç•™è¨€é˜¶æ®µ -->
    <view wx:if="{{stage === 'comment'}}" class="comment-stage">
      <view class="comment-target">
        <message-avatar account="{{selectedTarget.id}}" avatar="{{selectedTarget.avatar}}" size="40" />
        <view class="comment-target-info">
          <text class="comment-target-name">{{selectedTarget.name}}</text>
        </view>
      </view>
      <view class="forward-desc">[è½¬å‘] {{forwardFromNick}} çš„ä¼šè¯è®°å½•</view>
      <view class="comment-section">
        <input class="comment-input" placeholder="ç•™è¨€" value="{{comment}}" bindinput="handleCommentInput" />
      </view>
    </view>
    
    <!-- å¼¹çª—åº•éƒ¨ -->
    <view class="modal-footer">
      <view class="footer-cancel" wx:if="{{stage === 'select'}}" bindtap="handleClose">å–æ¶ˆ</view>
      <view class="footer-cancel" wx:elif="{{stage === 'comment'}}" bindtap="handleBackToSelect">è¿”å›</view>
      <view 
        class="footer-confirm {{(stage === 'comment') || (selectedContacts.length > 0) ? 'active' : ''}}"
        bindtap="handleConfirm"
      >
        {{stage === 'comment' ? 'å‘é€' : ('ç¡®å®š' + (selectedContacts.length > 0 ? '(' + selectedContacts.length + ')' : ''))}}
      </view>
    </view>
  </view>
</view>
