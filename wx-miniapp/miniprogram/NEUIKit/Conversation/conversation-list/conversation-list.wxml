<view class="conversation-wrapper">
  <!-- 下拉菜单遮罩：点击遮罩关闭下拉 -->
  <view wx:if="{{addDropdownVisible}}" class="dropdown-mark" bindtap="hideAddDropdown"></view>
  <!-- 状态栏占位 -->
  <view class="status-bar-placeholder" style="height: {{statusBarHeight}}px;"></view>
  <!-- 导航栏 -->
  <nav-bar 
    title="" 
    showLeft="{{true}}" 
    backgroundColor="#ffffff"
    logoSrc="https://yx-web-nosdn.netease.im/common/bbcd9929e31bfee02663fc0bcdabe1c5/yx-logo.png"
    appText="{{appText}}"
    showSetting="{{false}}"
  ></nav-bar>

  <network-alert></network-alert>

  <!-- 全局下拉容器（移出 scroll-view） -->
  <view wx:if="{{addDropdownVisible}}" class="dropdown-container-global" style="top: {{dropdownTop}}px; right: {{dropdownRight}}px;">
    <view class="add-menu-list">
      <view class="add-menu-item" catchtap="onAddFriend">
        <icon type="icon-tianjiahaoyou" style="margin-right: 5px;"></icon>
        {{addFriendText}}
      </view>
      <view class="add-menu-item" catchtap="onCreateGroup">
        <icon type="icon-chuangjianqunzu" style="margin-right: 5px;"></icon>
        {{createTeamText}}
      </view>
    </view>
  </view>
  
  <!-- 空状态 -->
  <view wx:if="{{!conversationList || conversationList.length === 0}}">
    <view class="security-tip">
      <view>{{securityTipText}}</view>
    </view>
    <!-- 搜索框和按钮组合 -->
    <view class="search-and-actions">
      <view class="conversation-search" bindtap="goToSearchPage">
        <view class="search-input-wrapper">
          <view class="search-icon-wrapper">
            <icon class="search-icon" size="{{16}}" color="#A6ADB6" type="icon-sousuo"></icon>
          </view>
          <view class="search-input">{{searchText}}</view>
        </view>
      </view>
      <!-- 移动到这里的按钮模块 -->
      <view class="{{buttonClass}}">
        <view class="button-icon-add" id="add-button" catchtap="showAddDropdown">
          <icon type="icon-addition" size="{{20}}"></icon>
        </view>
      </view>
    </view>
    <empty text="{{conversationEmptyText}}"></empty>
  </view>
  
  <!-- 会话列表 -->
  <scroll-view 
    wx:else
    class="conversation-list-wrapper"
    scroll-y="{{true}}"
    bindscroll="handleScroll"
    bindscrolltolower="handleScrollToLower"
    lower-threshold="50"
  >
    <view class="security-tip">
      <view>{{securityTipText}}</view>
    </view>
    <!-- 搜索框和按钮组合 -->
    <view class="search-and-actions">
      <view class="conversation-search" bindtap="goToSearchPage">
        <view class="search-input-wrapper">
          <view class="search-icon-wrapper">
            <icon class="search-icon" size="{{16}}" color="#A6ADB6" type="icon-sousuo"></icon>
          </view>
          <view class="search-input">{{searchText}}</view>
        </view>
      </view>
      <!-- 移动到这里的按钮模块 -->
      <view class="{{buttonClass}}">
        <view class="button-icon-add" id="add-button" catchtap="showAddDropdown">
          <icon type="icon-addition" size="{{24}}"></icon>
        </view>
      </view>
    </view>
    
    <view wx:for="{{conversationList}}" wx:key="conversationId">
      <conversation-item
        conversation="{{item}}"
        show-more-actions="{{currentMoveSessionId === item.conversationId}}"
        bind:click="handleSessionItemClick"
        bind:delete="handleSessionItemDeleteClick"
        bind:stickyToTop="handleSessionItemStickTopChange"
        bind:leftSlide="handleSessionItemLeftSlide"
      ></conversation-item>
    </view>

    <view wx:if="{{loadingMore}}" class="loading-text">{{loadingText}}</view>
    <view wx:if="{{noMore}}" class="msg-tip">{{noMoreText}}</view>
  </scroll-view>
</view>
